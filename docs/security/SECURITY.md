# VERAX Security Policy

**Version:** 1.0  
**Status:** Effective immediately  
**Contact:** See CONTRIBUTING.md  

---

## Executive Summary

VERAX is designed with security and organizational trust as foundational principles:

- **Client-side only** — No external services, no telemetry
- **Read-only** — VERAX does not modify your code or infrastructure
- **Deterministic** — No hidden logic, all rules are explicit
- **Auditable** — Every run records policy, config, and git state
- **Privacy-preserving** — Sensitive data redacted by default
- **Open source** — Code is public and auditable

This document covers VERAX's security posture, supply chain integrity, and how to report issues.

---

## Security by Design

### 1. No Network Access
- VERAX runs entirely on your machine
- No outbound connections to VERAX servers, SaaS platforms, or analytics services
- All dependencies are installed locally via npm
- Browser communication is limited to the target site (--url flag)

### 2. Read-Only Operation
- VERAX does not modify your source code, config, or deployed application
- VERAX does not execute your code (analysis is static + observation)
- VERAX does not have write access outside `.verax/` directory
- Safe to run in any environment (dev, staging, CI)

### 3. Deterministic Behavior
- No heuristics, no ML models, no guessing
- All detection rules are explicit and testable
- Same input → same output (determinism enforced by tests)
- No hidden side effects or adaptive behavior

### 4. Explicit Policies
- Enterprise policies are centralized and auditable
- Policy validation happens at startup (invalid policy → error)
- All policy decisions are logged in run manifest
- No default override without explicit flag

### 5. Redaction by Default
- Sensitive data (tokens, keys, passwords) redacted before writing to disk
- Redaction is ON by default, OFF requires explicit `--no-redaction` flag
- Redaction status recorded in every run manifest
- Enables safe CI/CD usage without secret rotation

---

## Supply Chain Security

### Dependency Management

**Lockfile:** `package-lock.json`
- Generated by `npm install`
- Locks exact versions of all dependencies (direct and transitive)
- Committed to git (enables reproducible builds)
- Validated by CI on every change

**Dependency Update Policy:**
- Security advisories are monitored (GitHub Dependabot)
- Critical/High severity vulnerabilities trigger immediate update
- Updates are tested in CI before merge
- Changelog documents security fixes
- Update frequency: As needed (security) + quarterly (routine)

**Supported Node Versions:**
- Minimum: Node 18.0.0 (LTS, widely used)
- Tested: Node 18, 20, 22 (LTS versions)
- Unsupported versions: Node <18 (deprecated)

**Supported Browser Versions:**
- Chrome/Chromium 80+
- Firefox 75+
- Safari 13+
- Edge 80+

(Determined by Playwright support: https://playwright.dev)

### Integrity Checks

**Package Verification:**
```bash
# Verify no dependencies have been tampered
npm ci --audit
```

**Lockfile Validation:**
- CI check ensures lockfile is present
- CI check ensures no dependency drift
- Test failure if lockfile is missing or out of sync

### Optional Dependencies
- `pngjs` — Optional, used for PNG screenshot processing
- If unavailable, VERAX falls back to base64 encoding
- Safe to install from npm registry

---

## Code & Artifact Security

### Source Code Auditing
- Repository is public on GitHub
- All code changes go through pull review
- Security-related changes are tagged with `security` label
- Contributors sign commits with GPG (recommended)

### Artifact Security

**Artifacts are stored locally in `.verax/`**
- No encryption applied by VERAX (use filesystem encryption if needed)
- Permissions follow umask (readable by user, process)
- Redaction prevents most secret leakage
- Retention policy enables automatic cleanup

**Sensitive Data Handling:**
- Redaction patterns cover: tokens, keys, passwords, auth headers, cookies
- API keys, JWT tokens, OAuth credentials are redacted
- Browser console output is redacted
- HTTP request/response bodies are selectively redacted

**Sharing Artifacts:**
- Never share `.verax/` if redaction is disabled
- Verify redaction was applied before sharing (grep for `[REDACTED]`)
- If you disabled redaction for debugging, rotate any exposed secrets
- Consider artifacts as potentially containing secrets

---

## CI/CD Security

### Safe Defaults
- CLI defaults are NON-BLOCKING (doesn't fail CI unless --ci-mode is used)
- Redaction is ON (safe for archived CI logs)
- Retention is ON (artifacts auto-cleaned)
- Policies are centralized (no per-job special cases)

### CI Usage Modes

**Advisory Mode (Recommended for PRs):**
```bash
verax run --url https://preview.example.com \
  --src ./src \
  --min-coverage 0.7
# Generates findings but doesn't block merge
# Developers review findings before acting
```

**Blocking Mode (For main branch):**
```bash
verax run --url https://staging.example.com \
  --src ./src \
  --min-coverage 0.7 \
  --ci-mode
# Exits with non-zero if findings detected
# Blocks merge until findings are resolved
```

### Secret Management in CI

**DO:**
- Use redaction enabled (default) in CI
- Store API keys in CI secret manager (GitHub Secrets, etc.)
- Pass secrets via environment variables to app (not VERAX)
- Clean up artifacts per job (ephemeral)

**DON'T:**
- Disable redaction unless debugging in isolated environment
- Pass secrets on command line (they'll be visible in logs)
- Archive unredacted VERAX artifacts
- Share .verax/ directory with untrusted parties
- Commit .verax/ to git (use .gitignore)

### Example: GitHub Actions

```yaml
name: VERAX Public Flow Check

on: [push, pull_request]

jobs:
  verax-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - run: npm ci
      
      - run: npm run build  # Build your app
      
      - run: npm install -g @veraxhq/verax  # Install VERAX
      
      - run: |
          # Start app (example)
          npm run dev &
          sleep 2
          
          # Run VERAX in advisory mode (non-blocking)
          verax run \
            --url http://localhost:3000 \
            --src ./src \
            --min-coverage 0.7
          
          # Results available in .verax/runs/latest/
          # Findings are reported but don't block merge
```

---

## Vulnerability Disclosure

### Reporting Security Issues

**DO NOT open a public GitHub issue for security vulnerabilities.**

Instead:

1. Email security report to: [See CONTRIBUTING.md for contact]
2. Include:
   - Description of vulnerability
   - Steps to reproduce
   - Impact assessment
   - Suggested fix (if available)

3. Allow 90 days for patch before public disclosure
4. We will:
   - Acknowledge receipt within 48 hours
   - Investigate and verify
   - Develop and test fix
   - Release patched version
   - Credit reporter (unless anonymity requested)

### Responsible Disclosure
- No public discussion of unpatched vulnerabilities
- No proof-of-concept code before patch is released
- Coordinated disclosure with announcement
- Security fix releases are expedited (same week)

---

## Known Limitations & Mitigations

### VERAX Doesn't Protect Against

| Risk | Mitigation |
|------|-----------|
| Authenticated flows | Use separate tools (Cypress, Playwright) for post-auth testing |
| Dynamic routes | VERAX marks them as OUT_OF_SCOPE; use additional tests |
| Business logic bugs | Use unit/integration tests for internal correctness |
| Backend vulnerabilities | Use API security scanning tools |
| DDoS attacks | Use infrastructure security tools |
| Malware in dependencies | Use `npm audit`, Dependabot, and code review |

### Scope Boundaries
- VERAX is limited to public, pre-auth flows
- VERAX is read-only (no infrastructure modification)
- VERAX assumes target URL is your application
- VERAX doesn't validate business logic correctness

---

## Security Checklist for Deployment

Before deploying VERAX in your organization:

- ✅ Review DATA-HANDLING.md (data retention policy)
- ✅ Review this SECURITY.md (security controls)
- ✅ Review ENTERPRISE-ADOPTION.md (governance & policies)
- ✅ Run `npm audit` (check for dependency vulnerabilities)
- ✅ Verify Node version is 18+ (use .nvmrc or similar)
- ✅ Verify lockfile exists and is committed to git
- ✅ Configure retention policy (keep last N runs)
- ✅ Enable redaction by default (don't use --no-redaction)
- ✅ Document VERAX usage in CI/CD runbook
- ✅ Test VERAX in non-production first
- ✅ Set up alerts for new dependencies (if using Dependabot)
- ✅ Document who can update dependencies
- ✅ Establish rollout plan (pilot, then org-wide)

---

## Compliance & Certifications

### Industry Standards
- **Open Source:** MIT license, source code public
- **Deterministic:** No randomness, no adaptive behavior
- **Auditable:** Run manifests record policy and config
- **GDPR-Ready:** Redaction, retention policy, local-only storage
- **SOC2-Compatible:** Supports VERAX usage in SOC2 environments

### Regulatory Considerations
- **PCI DSS:** VERAX doesn't process payment data (pre-auth flows only)
- **HIPAA:** VERAX doesn't process health data (scope is public flows)
- **SOC2:** Audit trail (run manifest) supports SOC2 logging requirements
- **GDPR:** Data handling policy supports GDPR compliance

---

## Testing & Verification

### Security Testing

**Dependencies:**
```bash
npm audit                          # Check for vulnerabilities
npm audit fix                      # Auto-fix low/moderate severity
npm audit fix --audit-level=high   # Escalate to high severity
```

**Code Review:**
```bash
npm run lint                       # Check for code quality issues
npm run typecheck                  # Check for type safety
npm test                           # Run security-relevant tests
```

**Lockfile Validation:**
```bash
npm ci --audit                     # Install from lockfile, verify integrity
npm diff                           # Check for unintended changes
```

### Automated Checks
- GitHub Actions run on every push
- `npm audit` blocks merge if critical issues found
- Lockfile validation ensures reproducible builds
- Dependency drift is detected and reported
- Code coverage is measured and tracked

---

## Updates & Patches

### Regular Updates
- **Routine:** Quarterly dependency updates (3/6/9/12 months)
- **Security:** Within 1 week of advisory (critical), 2 weeks (high)
- **Bugfixes:** Per release cycle

### Update Process
1. Create feature branch for updates
2. Run `npm update` and commit lockfile
3. Run full test suite (unit, integration, smoke)
4. Create PR with changelog entry
5. Code review required before merge
6. CI passes (security checks, tests, linting)
7. Merge and tag release
8. Publish to npm registry

### Rollback Procedure
If a patched version introduces regression:
1. Identify the problematic commit
2. Revert changes or patch locally
3. Test regression fix
4. Release patch version (e.g., 0.4.5 → 0.4.6)
5. Document root cause in release notes

---

## Security Contacts

- **GitHub Security Advisory:** https://github.com/odavlstudio/verax/security/advisories
- **Email:** [See CONTRIBUTING.md]
- **Issues:** Don't use public issues for security; use email instead

---

## References

- https://playwright.dev/docs/intro (Playwright security)
- https://nodejs.org/en/docs/guides/security/ (Node.js security guide)
- https://cheatsheetseries.owasp.org/ (OWASP security checklists)
- https://github.com/odavlstudio/verax (Source code)
- docs/VISION.md (VERAX scope and guarantees)
- docs/DATA-HANDLING.md (Data retention policy)
- docs/NON-GOALS.md (What VERAX does NOT do)

---

**Last Updated:** Gate ENTERPRISE Implementation  
**Effective:** Version 0.4.5+  
**Next Review:** Quarterly or upon security event  
**Status:** Approved for organizational use
